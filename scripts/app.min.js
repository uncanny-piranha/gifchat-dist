"use strict";angular.module("gifchatClientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"app/core/views/main.html",controller:"MainCtrl"}).when("/chatroom",{templateUrl:"app/core/views/chatroom.html",controller:"ChatroomCtrl",authenticate:!0}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth",function(e,n,t){e.$on("$routeChangeStart",function(e,r){r.$$route&&r.$$route.authenticate&&!t.isAuth()&&n.path("/")})}]),function(){function e(e,n,t,r){e.username=n.getCurrentUser(),e.userMessage,e.newUser,e.isLoggedIn=n.isLoggedIn,e.privateMessage=!1,e.privateMessageHash,e.privateMessageURL,e.usernameFriend,e.friendsName,e.chosenPrivate=!1,e.added=!1;var o=new Firebase("https://sizzling-fire-1984.firebaseio.com/usernames/"+e.username+"/messages"),s=t(o);e.messages=s.$asArray(),e.addMessage=function(t){n.sendMessage(e.friendsName,e.username,t),e.userMessage=""},e.setFriendUsername=function(n){e.friendsName=n,e.chosenPrivate=!0;var r=new Firebase("https://sizzling-fire-1984.firebaseio.com/usernames/"+e.username+"/messages/"+n),o=new Firebase("https://sizzling-fire-1984.firebaseio.com/usernames/"+n+"/messages/"+e.username),s=t(o),a=t(r);e.friendsMessages=s.$asArray(),e.privateMessages=a.$asArray()},e.addFriend=function(){e.added=!e.added},e.logout=function(){n.logout(),r.path("/")}}angular.module("gifchatClientApp").controller("ChatroomCtrl",e),e.$inject=["$scope","Auth","$firebase","$location"]}(),angular.module("gifchatClientApp").controller("MainCtrl",["$scope","$http","Auth","$location",function(e,n,t,r){e.user={},e.errors={},e.isLoggedIn=t.isLoggedIn,e.getCurrentUser=t.getCurrentUser,e.activeLogin=!1,e.activeSignup=!1,e.loading=!1,e.register=function(n){e.submitted=!0,n.$valid&&(e.loading=!0,e.errors={},t.createUser({username:e.user.username,password:e.user.password}).then(function(){e.loading=!1,r.path("/chatroom")}).catch(function(t){e.loading=!1,e.errors.other=t.data,t=t.data,angular.forEach(t.errors,function(t,r){n[r].$setValidity("mongoose",!1),e.errors[r]=t.message})}))},e.login=function(n){e.submitted=!0,e.errors={},n.$valid&&(e.loading=!0,t.login({username:e.user.username,password:e.user.password}).then(function(){e.loading=!1,r.path("/chatroom")}).catch(function(n){e.loading=!1,e.errors.other=n.data}))},e.activateLogin=function(){e.activeLogin=!e.activeLogin},e.activateSignup=function(){e.activeSignup=!e.activeSignup}}]),function(){function e(e){e.active=!1,e.activate=function(){e.active=!e.active}}angular.module("gifchatClientApp").controller("RootCtrl",e),e.$inject=["$scope"]}(),angular.module("gifchatClientApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(e,n,t,r){n.on("keydown",function(){return r.$setValidity("mongoose",!0)})}}}),angular.module("gifchatClientApp").factory("Auth",["$location","$rootScope","$http","$cookieStore","$q",function(e,n,t,r){var o="";return r.get("token")&&(o=r.get("username")),{login:function(e){return t.post("http://gifserver.azurewebsites.net/users/login",{username:e.username,password:e.password}).success(function(e){r.put("token",e.token),r.put("username",e.username),o=e.username}).error(function(e){console.log(e)})},logout:function(){r.remove("token"),o=""},createUser:function(e){return t.post("http://gifserver.azurewebsites.net/users/signup",{username:e.username,password:e.password}).success(function(e){r.put("token",e.token),r.put("username",e.username),o=e.username}).error(function(e){console.log(e)})},getCurrentUser:function(){return o},isLoggedIn:function(){return r.get("token")?!0:!1},sendMessage:function(e,n,r){return t.post("http://gifserver.azurewebsites.net/gifs",{to:e,from:n,keyword:r}).error(function(e){console.log(e)})},getToken:function(){return r.get("token")},isAuth:function(){return!!r.get("token")}}}]);