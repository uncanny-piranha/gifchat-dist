!function(){"use strict";angular.module("gifchatClientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"app/core/views/home.html",controller:"HomeCtrl"}).when("/chatroom",{templateUrl:"app/core/views/chatroom.html",controller:"ChatroomCtrl",authenticate:!0}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth",function(e,n,t){e.$on("$routeChangeStart",function(e,r){r.$$route&&r.$$route.authenticate&&!t.isLoggedIn()&&n.path("/")})}])}(),function(){"use strict";function e(e,n,t,r){e.username=n.getCurrentUser(),e.userMessage,e.newUser,e.privateMessage=!1,e.friendsName,e.chosenPrivate=!1,e.added=!1;var s=new Firebase("https://scalding-fire-2109.firebaseio.com/usernames/"+e.username+"/messages"),o=t(s);e.messages=o.$asArray(),e.addMessage=function(t){n.sendMessage(e.friendsName,e.username,t),e.userMessage=""},e.clearUnreadMessages=function(n){if(n){var t=new Firebase("https://scalding-fire-2109.firebaseio.com/usernames/"+e.username+"/messages/"+n),r=t.child("unread");r.set("0")}},e.setFriendUsername=function(n){e.friendsName=n,e.chosenPrivate=!0;var r=new Firebase("https://scalding-fire-2109.firebaseio.com/usernames/"+e.username+"/messages/"+n),s=new Firebase("https://scalding-fire-2109.firebaseio.com/usernames/"+n+"/messages/"+e.username),o=r.child("messages"),a=s.child("messages"),i=t(a),u=t(o),c=r.child("unread");c.set("0"),e.friendsMessages=i.$asArray(),e.privateMessages=u.$asArray()},e.addFriend=function(){e.added=!e.added},e.logout=function(){n.logout(),r.path("/")}}angular.module("gifchatClientApp").controller("ChatroomCtrl",e),e.$inject=["$scope","Auth","$firebase","$location"]}(),function(){"use strict";function e(e,n,t,r){e.user={},e.errors={},e.getCurrentUser=t.getCurrentUser,e.activeLogin=!1,e.activeSignup=!1,e.loading=!1,e.register=function(n){e.submitted=!0,n.$valid&&(e.loading=!0,e.errors={},t.createUser({username:e.user.username,password:e.user.password}).then(function(){e.loading=!1,r.path("/chatroom")}).catch(function(t){e.loading=!1,e.errors.other=t.data,t=t.data,angular.forEach(t.errors,function(t,r){n[r].$setValidity("mongoose",!1),e.errors[r]=t.message})}))},e.login=function(n){e.submitted=!0,e.errors={},n.$valid&&(e.loading=!0,t.login({username:e.user.username,password:e.user.password}).then(function(){e.loading=!1,r.path("/chatroom")}).catch(function(n){e.loading=!1,e.errors.other=n.data}))},e.activateLogin=function(){e.activeLogin=!e.activeLogin},e.activateSignup=function(){e.activeSignup=!e.activeSignup}}angular.module("gifchatClientApp").controller("HomeCtrl",e),e.$inject=["$scope","$http","Auth","$location"]}(),function(){"use strict";function e(e,n){e.active=!1,e.isLoggedIn=n.isLoggedIn,e.activate=function(){e.active=!e.active}}angular.module("gifchatClientApp").controller("LoggedInCtrl",e),e.$inject=["$scope","Auth"]}(),angular.module("gifchatClientApp").factory("Auth",["$location","$rootScope","$http","$cookieStore","$q",function(e,n,t,r){var s="";return r.get("token")&&(s=r.get("username")),{login:function(e){return t.post("http://gifserver.azurewebsites.net/users/login",{username:e.username,password:e.password}).success(function(e){r.put("token",e.token),r.put("username",e.username),s=e.username}).error(function(e){console.log(e)})},logout:function(){r.remove("token"),r.remove("username"),s=""},createUser:function(e){return t.post("http://gifserver.azurewebsites.net/users/signup",{username:e.username,password:e.password}).success(function(e){r.put("token",e.token),r.put("username",e.username),s=e.username}).error(function(e){console.log(e)})},getCurrentUser:function(){return s},isLoggedIn:function(){return r.get("token")?!0:!1},sendMessage:function(e,n,r){return t.post("http://gifserver.azurewebsites.net/gifs",{to:e,from:n,keyword:r}).error(function(e){console.log(e)})},getToken:function(){return r.get("token")}}}]);